name: Build Masscan for Windows

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]
  workflow_dispatch:  # 允许手动触发

jobs:
  build-windows:
    runs-on: windows-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      
    - name: Install build tools
      run: |
        # 安装 MinGW (GCC 编译器) 和 make
        choco install mingw make -y
        
    - name: Build Masscan
      run: |
        # 使用 MinGW 的 make
        mingw32-make
        
    - name: Test the executable
      run: |
        .\masscan.exe --help
        
    - name: Upload Windows executable
      uses: actions/upload-artifact@v4
      with:
        name: masscan-windows
        path: masscan.exe